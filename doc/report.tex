\documentclass[oneside, final, 14pt]{extarticle}
\usepackage[utf8]{inputenc}
\usepackage[russianb]{babel}
\usepackage[paper=a4paper, left=3cm, top=2cm, bottom=2cm, right=1cm]{geometry}
\usepackage{indentfirst}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{verbatim}
\usepackage{ntheorem}
\usepackage{graphicx}
\usepackage{multicol}
\usepackage{algorithmic}
\usepackage{moreverb}

\begin{document}

\begin{titlepage}

%\newgeometry{margin=1cm}

\centerline{\bf МИНИСТЕРСТВО ОБРАЗОВАНИЯ РЕСПУБЛИКИ БЕЛАРУСЬ}
\bigskip
\bigskip
\centerline{\bf БЕЛОРУССКИЙ ГОСУДАРСТВЕННЫЙ УНИВЕРСИТЕТ}
\bigskip
\bigskip
\centerline{\bf ФАКУЛЬТЕТ ПРИКЛАДНОЙ МАТЕМАТИКИ И ИНФОРМАТИКИ}
\bigskip
\bigskip
\centerline{\bf Кафедра дискретной математики и алгоритмики}
\vfill
\vfill
\vfill
\centerline{\bf СИНЯК СЕРГЕЙ АЛЕКСАНДРОВИЧ}
\bigskip
\bigskip
\centerline{\large \bf РАСПОЗНАВАНИЕ ЗВУКА}
\vfill
\begin{centering}
  {
  Курсовой проект \\
  студента 3 курса, 3 группы, специальность <<информатика>> \\}
\end{centering}
\vfill
\vfill
\hfill
\begin{minipage}{0.35\textwidth}
  {\bf Научный руководитель \\
  {\small{\it Буславский Александр \\ Андреевич}}}
\end{minipage}
\vfill
\vfill
\centerline{\large \bf Минск 2015}

\restoregeometry

\end{titlepage}

\begin{abstract}
	Рассмотрено прототип алгоритма распознавания высоты звука
\end{abstract}

\setcounter{page}{2}

\cleardoublepage

\centerline{\bf Реферат}

Курсовой проект, 15 стр., 4 рис, 5 источников.

ОБРАБОТКА ЦИФРОВЫХ СИГНАЛОВ, АВТОМАТИЧЕСКАЯ ТРАНСКРИПЦИЯ МУЗЫКИ,
ПРЕОБРАЗОВАНИЕ ФУРЬЕ, ОПРЕДЕЛЕНИЕ ВЫСОТЫ ЗВУКА, ФУНДАМЕНТАЛЬНОЙ
ЧАСТОТЫ

Объектом исследования являются алгоритмы позволяющие анализировать
музыкальные аудио записи и определять временной диапозон и высоту
нот.

Цели работы:
\begin{enumerate}
	\item Изучить литературу по данной теме.
	\item Рассмотреть существующие и предложить собственный методы решения
	задачи.
	\item Оценить качество распознавания рассматриваемых алгоритмов.
\end{enumerate}

Методы проведения работы: методы математического анализа, логико-комбинаторные
методы.

Область применения результатов: исследования в обработке цифровых сигналов,
автоматическое распознавание и последующая генерация музыки с помощью
компьютера в различных приложениях.

\cleardoublepage


\tableofcontents
\cleardoublepage

\section{Введение}
	Автоматическая музыкальная транскрпция, т.е. анализ записи музыкального произведения
	и генерация его нотной записи, партитура, представляет собой очень интерестную задачу.

	Сама исходная задача впервые упоминалась в конце 1970-х годов. И к нашему времени
	существует множество частных решений данной проблемы. Большинство продуктов позволяют
	производить распознавание в полуавтоматическом режиме в силу допускаемых неточностей
	при распознавании. Особенно сложным является случай полифонического произведения.
	Для монофонических же мелодий точность существующих методов гораздо выше.

	В случае исходной постановки задачи требуется распознать нотную последовательность,
	а затем её воспроизвести. Дополнительно было указано, что длина не более 100 нот,
	мелодия может быть исполнена инструментом, либо непосредственно голосом человека,
	также имеется набор шаблонов нот.

	На данный момент требуется решить две проблемы, это разбиение мелодии на звуковые
	фрагменты соотвествующе отдельным нотам, а также определить фундаментальную частоту
	или высоту ноты.

	Первая проблема имеет интерестный вариант решения с помощью метода авторегрессии,
	который позволяет определять моменты начала звучания ноты. Но практическое
	применеие данного метода, требует дополнительные исследования, поэтому в данной
	работе не приводяться.

	Вторая же часть, собственно распознавание фундаментальной частоты и рассматривается
	на примере использования преобразования Фурье.

	Отмечу ещё раз, что существует большое разнообразие методов, и каждый из них
	не решает поставленную задачу точно. Поэтому независимо от выбранного метода, хотя
	бы описанных, необходимо проводить тестирование эксперементальное и оценивать
	погрешность результата.

	Имея сгенерированную нотную последовательность, обычно в формате MIDI, не составляет
	труда воспроизвести и требует лишь программной реализации.
\cleardoublepage

\section{Некоторые сведение из теории музыки}

	В музыке, термин нота имеет два основных значения:

	\begin{enumerate}
		\item Знак используемый в музыкальной нотация для представления
			относительной длительности и высоты звука
		\item В смысле испольенного звука
	\end{enumerate}

	Две ноты в фундаментальной частотой с отношением равным некоторой
	степени двойки (например 1/2, 2, или 4) звучат доволе похожим
	образом. По этой причине, все ноты с отношением такого рода могут
	быть отнесены к одному классу по высоте.

	В традиционной теории музыки, большинство стран в мире использует
	соглашения именования До--Ре--Ми--Фа--Соль--Ля--Си. Но также используется
	представления в виде первых 7 букв латинского алфавита (A, H, C, D,
	E, F, G, где А --- это нота ля).

	Восьмая нота, или октава, имеет такое же имя как и первая, но её частота
	удваивается. Имя октава также используется для указания дистанции между
	нотой и другой нотой с удвоенной частотой. Для различия двух нот из одного
	класса по высоте но расположенных в различных октавах, буква имени
	комбинируется с номером октавы. Например, 440 Гц именуется A4.

	Расстояние между двумя соседними нотами До--Ре, Ре--Ми, Фа--Соль, Соль--Ля,
	Ля--Си составляет тон, а между нотами Ми--Фа и Си--До - полутон. Отношение
	в полутон для частот нот выражется множителем $\sqrt[12]{2}$. Обычно
	шесть тонов октавы разбивают на 12 полутонов. Повышение или понижение
	ноты на полутон обозначается специальнами знаками $\sharp$ --- диез,
	$\flat$ --- бемоль. Например $A\sharp$, $E\flat$.

\cleardoublepage
\section{Цифровой сигнал}
	Под сигналом понимается физическая величина значения которой можно представить в виде функции от времени, пространства
	и другое.

	В случае аналогового аудио сигнала он может представлен как функция $s(t)$ изменения давления воздуха непрерывно
	зависящая от времени. Для цифровой обработки необходимо представления в виде сигнала с дискретным временем. Для
	этого применяют семплирование сигнала с непрерывным временем в изолированные, равностоящие точки времени. В результате
	получается численная последовательность определяемая:
	\[
		s[n] = s(nT),
	\]
	где $n$ есть целое число $\{\dots, -1, 0, 1, 2, \dots\}$ and $T$ есть период семплирования. Величина $Fs=1/T$, известна
	как частота семплирования или скорость семплирования, отображает число семплов в секунду. Если сигнал $s[n]$ принимает
	значения из конечного множества чисел, то его называют цифровым сигналом.

\cleardoublepage
\section{Алгоритм преобразования Фурье}
	Система гармонически связанных комплесных экспонент имеет вид

	\[
		s_k[n]=e^{i\tfrac{2\pi}{N}kn}, \; k=\in{0,N-1}
	\]

	Для $s_k[n]$ выполняются следующие свойства

	\begin{enumerate}
	\item периодичность по времени \[
		s_k[n + N] = s_k[n],
	\]
	\item периодичность по частоте
	\[
		s_{k+N}[n] = s_k[n],
	\]
	\item ортогональность
	\[
		\sum_{k=0}^{N-1} s_k[n]s_m^*[n] = \sum_{k=0}^{N-1} e^{i\tfrac{2\pi}{N}kn} e^{i\tfrac{2\pi}{N}mn} =
		\left\{ \begin{aligned}
				N, \; k = m ,\\
				0, \; k \not= m.
			\end{aligned}
		\right.
	\]
	\end{enumerate}

	Рассмотрим фрагмент сигнала $s[n]$ где $n \in \{0,\cdots,N-1\}$. Представим его как линейную комбинацию экспонент комплексного
	аргумента
	\[
		x[n] = \sum_{k=0}^{N-1} c_k e^{i\tfrac{2\pi}{N}kn}.
	\]

	Используя свойство ортогональности найдем неизвестные коэффициенты~$c_k$
	\[
		c_k = \dfrac{1}{N} \sum_{k=0}^{N-1} x[n] e^{-i\tfrac{2\pi}{N}kn}.
	\]

	График $|c_k|$ от $k$ есть спектрограмма фрагмента сигнала $s[n]$, где $k$ --- частота,
	а $|c_k|$ магнитуда этой частоты.

	Заметим, что если исходная запись содержала компоненту с частотой $f_0$, то
	в при семплировании нормализированная частота $F$ будет иметь вид $F=\dfrac{f_0}{Fs}$.
	Коэфициенты $k$ отражают частоту не в Гц. Поэтому для распознавания их необходимо преобразовать,
	домножив на $\dfrac{Fs}{N}$.

\cleardoublepage
\section{Реализация прототипа алгоритма в Octave}
	Программа Octave представляет собой OpenSource версию проприетарного приложения
	Matlab. В данном случае это позволяет визуализировать работу алгоритма с помощью
	встроенных средств построения графики. Что касается скорости работы, то это не
	принципиально и в конечном приложении производительность может быть увеличена
	засчет использования компилируемых языков типа C, C++.

	В приложении А приведен пример кода программы на Octave.

\cleardoublepage
\section{Практическое применения для анализа цифровой аудио записи}

	Для пробной проверки были сделана запись простой мелодии ля-до-ми в исполнении мужчины
	в малой октаве. Отметим, что запись производилась через микрофон ноутбука с
	достаточно плохим качеством записи. Ещё более усугубляющим фактором является
	работа бортового куллера на частоте порядка 100Гц.

	Искомые частоты нот будут соответственно A3 - 220Гц, C3 - 130Гц, E3 - 166Гц.

	Первоначально построим спектрограмму всего трека.
	\begin{figure}[h]
		\begin{multicols}{2}
			\hfill
			\includegraphics[width=80mm]{res/track.pdf}
			\hfill
			\caption{3D спектрограмма из Octave а}
			\label{pic_3da}
			\hfill
			\includegraphics[width=80mm]{res/track3d.pdf}
			\hfill
			\caption{3D спектрограмма из Octave б}
			\label{pic_3db}
		\end{multicols}
	\end{figure}

	Теперь выделим предполагаемый временной интервал для ноты ля и построим
	для него усредненную спектрограмму (Рис \ref{pic_p1_3d} $-$ \ref{pic_p1_ms}).

	\begin{figure}[t]
		\begin{multicols}{2}
			\hfill
			\includegraphics[width=80mm]{res/track_p1_3d_s.pdf}
			\hfill
			\caption{временной отрезок [0, 0.2], 3D спектрограмма }
			\label{pic_p1_3d}
			\hfill
			\includegraphics[width=80mm]{res/track_p1_ms.pdf}
			\hfill
			\caption{временной отрезок [0, 0.2], усредненная спектрограмма }
			\label{pic_p1_ms}
		\end{multicols}
	\end{figure}

	Как видим максимальным по амлпитуде является некоторый сигнал с частотой менее
	100Гц, следующим по убыванию можно выделить сигнал с частотой 210-220Гц.

	Если быть точным, то в окрестности частоты 210 усредненная спектрограмма содержит
	следующие значения:

	\begin{tabular}[t]{|c|c|c|c|c|c|c|c|c|c|}
		\hline
		$20 log_{10}|c_k|$ & -52 & -53 & -45 & -41 & -43 & -53 & -52 & -58 & -54 \\
		\hline
		$k Fs/N$ & 183 & 194 & 205 & 215 & 226 & 237 & 248 & 258 & 269 \\
		\hline
	\end{tabular}

	Попробуем уточнить результат увеличив ширину окна.

	Для удвоенного размера окна имеем:

	\begin{tabular}[t]{|c|c|c|c|c|c|c|c|c|c|}
		\hline
		$20 log_{10}|c_k|$ & -52 & -48 & -44 & -45 & -51 & -53 & -57 \\
		\hline
		$k Fs/N$ & 205 & 210 & 215 & 221 & 226 & 231 & 237 \\
		\hline
	\end{tabular}

	В случае 4-х кратного увелечения размера окна получаем:

	\begin{tabular}[t]{|c|c|c|c|c|c|c|c|}
		\hline
		$20 log_{10}|c_k|$ & -54 & -52 & -49 & -48 & -49 & -52 & -53 \\
		\hline
		$k Fs/N$ & 210 & 213 & 215 & 218 & 221 & 223 & 226 \\
		\hline
	\end{tabular}


	Получаем, что локальный максимум достигается при частоте 218Гц. Учитывая,
	что частоты соседних нот G3\# $-$ 208Гц, A3\# $-$ 233Гц, то это нота A3.

\cleardoublepage

{\large \bf Заключение \\}
\addcontentsline{toc}{section}{Заключение}
	Был рассмотрен прототип алгоритма определения фундаментальной частоты фрагмента
	цифрового сигнала с помощью преобразования Фурье, который может быть
	использован для построения приложения распознавания последовательности нот.

\cleardoublepage
\addcontentsline{toc}{section}{\bibname}
\begin{thebibliography}{0}

	\bibitem{big_dsp_theory} Manolakis D. Applied digital signal
		processing: theory and practice, 2011 --- 157с.

	%\bibitem{dsp_matlab_practise} G. Blanchet and M. Charbit. Digital Signal
	%	and Image Processing using MATLAB, Volume 2: Advances and Applications:
	%	The Deterministic Case [2 ed.] 2014

	\bibitem{GDPE} Gerhard D., Pitch Extraction and Fundemental Frequency:
		History and Current Techniques, Technical Report TR-CS 2003-06, November, 2003

	\bibitem{GDCMA} Gerhard D., Computer Music Analysis, Techincal Report CMPT
		TR 97-13, October 13, 1997

	\bibitem{WMT} https://en.wikipedia.org/wiki/Transcription\_(music)

	\bibitem{WMP} https://en.wikipedia.org/wiki/Pitch\_(music)

\end{thebibliography}

\cleardoublepage
\appendix
{\large \bf Приложение A} \\
\listinginput[1]{1}{test2.m}


\end{document}
% vi: tabstop=4 sw=4
